#

XETEXCONF=--section-numbering --template=latex2e/xelatex.tex --documentclass=book --documentoptions=11pt,twoside,letterpaper --use-latex-docinfo --section-subtitles --smart-quotes=yes -g -l es --toc-top-backlinks --compound-enumerators

GV=*.gv
SVG=*.svg


SUBDIRS = gv Imágenes/svg

.PHONY: subdirs $(SUBDIRS)

subdirs: $(SUBDIRS)

$(SUBDIRS):
	$(MAKE) -C $@

# see http://tex.stackexchange.com/questions/40738/how-to-properly-make-a-latex-project

# You want latexmk to *always* run, because make does not have all the info.
# Also, include non-file targets in .PHONY so they are run regardless of any
# file of the given name existing.
.PHONY: Documento.pdf all clean

%.tex: $(GV)
	dot2tex $< -o $@

%.pdf: $(SVG)
	inkscape -z -f $< --export-pdf="$@" --export-latex


# The first rule in a Makefile is the one executed by default ("make"). It
# should always be the "all" rule, so that "make" and "make all" are identical.
all: Documento.pdf

SOURCE=Documento

Documento.tex: $(SOURCE).rst  000-Configuración.rst 001-Caratula.rst 002-Dedicatoria.rst 003-Agradecimientos.rst 004-FichaResumen.rst 005-IndiceGeneral.rst 006-IndiceDeFiguras.rst 007-IndiceDeTablas.rst 008-Introducción.rst 009-Deshidratación.rst 010-ControlAutomático.rst 011-Herramientas.rst 012-Metodologia.rst 013-SprintA.rst 014-Conclusiones.rst 015-Bibliografía.rst 100-Anexo01-CodigoFuente.rst 101-Anexos-Anexos.rst 102-Anexo07-SeguimientoSprintA.rst
	rst2xetex $(XETEXCONF) $(SOURCE).rst $(SOURCE).tex
	sed -i '/^Generated by \\href{/d' $(SOURCE).tex
	sed -i 's/\\begin{document}/\\title{Mejoramiento del Proceso de deshidratación mediante la construcción de un sistema de control automático}\n\\author{Daniel Rodrigo Saguez Tezanos Pinto}\n\\date{Diciembre, 2015}\n\\begin{document}/g' $(SOURCE).tex
	sed -i 's/{[ ]\+/{/g' $(SOURCE).tex
	sed -i 's/[ ]\+}/}/g' $(SOURCE).tex
	sed -i 's/... continued on next page/... Continua en la siguiente página/g' $(SOURCE).tex
	sed -i 's/... continued/... continuación/g' $(SOURCE).tex
	sed -i 's/\\setcounter{secnumdepth}{0}/\\setcounter{secnumdepth}{3}/g' $(SOURCE).tex


Documento.pdf: $(SOURCE).tex $(SVG) $(GV)
	latexmk -xelatex -use-make $(SOURCE).tex

clean:
	latexmk -CA
	rm $(SOURCE).tex

